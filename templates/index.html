<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"
        integrity="sha512-M7nHCiNUOwFt6Us3r8alutZLm9qMt4s9951uo8jqO4UwJ1hziseL6O3ndFyigx6+LREfZqnhHxYjKRJ8ZQ69DQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="https://unpkg.com/d3-3d@3.0.4/build/d3-3d.js"></script> -->
    <!-- chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- STATIC -->
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
    <!-- ECHART -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.common.min.js"
        integrity="sha512-0wDoQXJkUrgPk8OvsJ/hSJiBVXiII1ixzjKddv6RQUoCTZsB9GRF4S6oszAqeSgU6FlSusayKNC2VTUpZsb9pA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- APEXCHART -->
    <!-- 引入 ApexCharts 库 -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- 引入 ApexCharts 的样式 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.26.1/dist/apexcharts.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- font -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arima:wght@500&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> -->
    <link href="https://fonts.googleapis.com/css2?family=Monoton&display=swap" rel="stylesheet">

    <!-- EMBED -->
    <script src="https://open.spotify.com/embed/iframe-api/v1" async></script>
    <title>LETS XSS SPOTIFY</title>
</head>

<body>
    <div class="row">
        <div class="col-3 shelf">
            <div style="margin-top: 58%;">
                <div id="double_genere1"
                    style="transform: rotateX(6deg) rotateY(38deg) rotateZ(-19deg);margin-top: -13%;" class="left L3">
                </div>
                <div class="left L2" style="display: flex;">
                    <svg width="234" height="81" viewBox="0 0 234 81" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M149.926 1L233 12.85V21.8273L81.2104 80L1 63.1227V52.7091L149.926 1Z" fill="black" />
                        <path
                            d="M1 52.7091L81.2104 69.2273M1 52.7091L149.926 1L233 12.85M1 52.7091V63.1227L81.2104 80M81.2104 69.2273L233 12.85M81.2104 69.2273V80M233 12.85V21.8273L81.2104 80"
                            stroke="#DBDBDB" />
                    </svg>


                </div>
                <div id="double_genere2"
                    style="transform: rotateX(6deg) rotateY(38deg) rotateZ(-19deg);margin-top: -13%;" class="left L1">
                </div>

                <div class="left">
                    <svg width="234" height="81" viewBox="0 0 234 81" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M149.926 1L233 12.85V21.8273L81.2104 80L1 63.1227V52.7091L149.926 1Z" fill="black" />
                        <path
                            d="M1 52.7091L81.2104 69.2273M1 52.7091L149.926 1L233 12.85M1 52.7091V63.1227L81.2104 80M81.2104 69.2273L233 12.85M81.2104 69.2273V80M233 12.85V21.8273L81.2104 80"
                            stroke="#DBDBDB" />
                    </svg>


                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="three_cube">
                YOUR TREND ARTIST
                <div class="row mb-3">
                    <a href="{{ recent_3_artist[0]['url'] }}" class="cube" id="A0" style="margin-right: 3%;"
                        data-text="{{ recent_3_artist[0]['name'] }}"></a>
                    <a href="{{ recent_3_artist[1]['url'] }}" class="cube" id="A1" style="margin-right: 3%;"
                        data-text="{{ recent_3_artist[1]['name'] }}"></a>
                    <a href="{{ recent_3_artist[2]['url'] }}" class="cube" id="A2"
                        data-text="{{ recent_3_artist[2]['name'] }}"></a>
                </div>
                MY TREND ARTIST
                <div class="row">

                    <a href="" class="cube" id="B0" style="margin-right: 3%;" data-text=""></a>
                    <a href="" class="cube" id="B1" style="margin-right: 3%;" data-text=""></a>
                    <a href="" class="cube" id="B2" data-text=""></a>

                </div>
            </div>
        </div>
        <div class="col-5">
            <div class="row RADAR" style="margin-top: 25%;">
                <div class="col-6" id="radar"></div>
                <div class="col-6 d-flex flex-column align-items-center justify-content-center">
                    <p style="font-family: 'Arima', cursive; color:rgb(251, 171, 142);">The KEYWORD of your
                        music taste is</p>
                    <p style="font-family: 'Arima', cursive; color:crgb(251, 171, 142);font-size: x-large;">High
                        energy, Blue
                </div>
            </div>

        </div>

    </div>
    <!-- <div class="col-2">4</div> -->
    </div>
    <div class="row" style="margin-top: -5%;">
        <div class="col-3"></div>
        <div class="col-3 L2">
            <svg width="389" height="257" viewBox="0 0 389 257" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 256L1 250.75V45.25L183.625 1L190 4.375V9.05114L388 48.9471V244.75L179.5 201.399L7 256Z"
                    fill="black" />
                <path
                    d="M1 45.25L7 49M1 45.25V250.75L7 256M1 45.25L183.625 1L190 4.375M7 49V256M7 49L179.5 6.93545M7 256L179.5 201.399M190 4.375L179.5 6.93545M190 4.375V9.05114M179.5 6.93545V201.399M179.5 6.93545L190 9.05114M179.5 201.399L388 244.75V48.9471L190 9.05114"
                    stroke="white" stroke-width="2" stroke-linejoin="round" />
            </svg>
        </div>
        <div class="col-3 L1" style="margin-left: -9%;margin-top: -1%;">
            <svg width="624" height="278" viewBox="0 0 624 278" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M26.9167 85.6573L257.575 1L567.711 49.8075V78.3146L552.161 85.8316L623 96.8873V125.826L558.208 156.9V169.883L335.757 277L16.9819 207.46V177.225L54.1292 163.513L1 151.91V121.939L26.9167 112.437V85.6573Z"
                    fill="black" />
                <path
                    d="M26.9167 85.6573L346.124 151.742M26.9167 85.6573L257.575 1L567.711 49.8075M26.9167 85.6573V112.437M346.124 185.432V151.742M346.124 185.432L332.733 182.497M346.124 185.432L543.09 90.2165M346.124 151.742L567.711 49.8075M567.711 49.8075V78.3146L552.161 85.8316M332.733 182.497L26.9167 115.46V112.437M332.733 182.497L320.639 188.023M320.639 188.023V221.714M320.639 188.023L1 121.939M320.639 221.714L54.1292 163.513M320.639 221.714L330.142 217.119M543.09 90.2165V114.164L377.656 194.148M543.09 90.2165L552.161 85.8316M26.9167 112.437L1 121.939M1 121.939V151.91L54.1292 163.513M54.1292 163.513L16.9819 177.225M16.9819 177.225V207.46L335.757 277M16.9819 177.225L335.757 243.742M335.757 277V243.742M335.757 277L558.208 169.883V156.9M335.757 243.742L373.336 226.563M330.142 217.119L377.656 194.148M330.142 217.119L373.336 226.563M400.549 232.512V199.254M400.549 232.512L558.208 156.9M400.549 232.512L373.336 226.563M400.549 199.254L377.656 194.148M400.549 199.254L623 96.8873M623 96.8873L552.161 85.8316M623 96.8873V125.826L558.208 156.9"
                    stroke="white" stroke-width="2" stroke-linejoin="round" />
            </svg>


        </div>
        <div class="col-3 L3" style="margin-left: -9%;margin-top: 1%;">
            <svg width="174" height="40" viewBox="0 0 174 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 11.1315L173.5 39" stroke="#DD7676" stroke-width="2" stroke-linejoin="round" />
                <path d="M87.7529 1L79 11.241H97L87.7529 1Z" stroke="#DD7676" stroke-width="2"
                    stroke-linejoin="round" />
                <ellipse cx="44.5494" cy="19.023" rx="5.51769" ry="4.44617" transform="rotate(-4.49542 44.5494 19.023)"
                    fill="#DD7676" />
            </svg>
            <p style="position: relative;transform: rotateX(30deg) rotateY(-23deg) rotateZ(22deg);">{{ current_track[0]
                }}</p>

        </div>
    </div>

    <div class="circle L3" style="margin-top: -14%;margin-left: 27%;" id="circle">
        <div class="text">Get Recommend playlist</div>
    </div>
    <div class="L4" id="playlist" style="display: none; margin-top: -4%; margin-left: 22%;">
        <iframe title="Spotify Embed: Recommendation Playlist"
            src="https://open.spotify.com/embed/playlist/6rEmOxLIyUjufEXs5a1aDZ?utm_source=generator&theme=0"
            width="28%" height="100%" frameborder="1%"
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
    </div>
    <script>
        const circle = document.getElementById('circle');
        const playlist = document.getElementById('playlist');

        circle.addEventListener('click', () => {
            playlist.style.display = playlist.style.display === 'block' ? 'none' : 'block';
        });
    </script>

    <!-- <h2>currently playing = {{ current_track }}</h2> -->
    <!-- <p>{{ recent_3_artist }}</p> -->
    <!-- 使用 home 路由的數據 -->

    <!-- 使用 about 路由的數據 -->
    <!-- <h2>top 50's total = {{ top_50_artist }}</h2> -->

    <!-- 其他 HTML 和 JavaScript 代碼 -->
    <!-- <script src="{{ url_for('static', filename='js/d3.js') }}"></script> -->

    <!-- D3-chart -->
    <script>
        // 資料
        // 在兩個容器中分別創建餅圖
        livedata = {{
            top_50_artist | safe
        }};
        // livedata = livedata['count'];
        createPieChart("double_genere1", livedata);
        // 使用 JavaScript 讀取 JSON 檔案
        fetch('static/users_top_artist.json')
            .then(response => response.json())
            .then(data => {
                // 在這裡使用 data 對 HTML 做相應的操作
                console.log(data);
                createPieChart("double_genere2", data);

            })

        function createPieChart(containerId, livedata) {
            console.log(typeof (livedata));
            data = livedata['count'];
            data2 = livedata;
            // 餅狀圖的寬度和高度
            var width = 170;
            var height = 170;

            var svg = d3.select("#" + containerId)
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            // 定義餅狀圖的弧形函數
            var arc = d3.arc()
                .innerRadius(width / 5) // 內半徑，即甜甜圈的大小
                .outerRadius(Math.min(width, height) / 2);

            // 創建一個D3.js的餅狀圖
            var pie = d3.pie();
            // 設定漸層顏色
            var colors = generateColors(data.length);

            // 自定義排序，確保標籤的順序與圓弧一致
            var sortedData = pie(data).sort(function (a, b) {
                return a.index - b.index;
            });
            /* console.log(sortedData); */




            // 添加圓弧到SVG容器
            var arcs = svg.selectAll("path")
                .data(sortedData)
                .enter()
                .append("path")
                .attr("d", arc)
                .attr("fill", function (d, i) {
                    // 使用漸層顏色
                    return colors[i];
                }); // 將陰影應用到圓弧上

            // 添加標籤
            var labels = svg.selectAll("text")
                .data(sortedData)
                .enter()
                .append("text")
                .text(function (d) {
                    return data2['name'][d.index];
                })
                .attr("transform", function (d) {
                    return "translate(" + arc.centroid(d) + ")";
                })
                .style("text-anchor", "middle")
                .style("fill", "#F37D0E")
                .style("font-family", "'Arima', sans-serif") // 设置 Google Fonts 字体
                .attr("opacity", 0) // 初始將標籤設為透明


            // 添加事件處理
            arcs.on("mouseover", function (d, i) {
                labels.attr("opacity", function (labelData, labelIndex) {
                    return labelIndex === i.index ? 1 : 0;
                });
            })
                .on("mouseout", function (d, i) {
                    labels.attr("opacity", 0);
                });
        }
        // 產生漸層顏色
        function generateColors(count) {
            var colors = [];
            for (var i = 0; i < count; i++) {
                var hue = [
                    214 - ((i * (24 / count)) % 24), // 色相 (214 - 190)
                    97 + ((i * (20 / count)) % 20),  // 飽和度 (97 - 77)
                    27 + ((i * (61 / count)) % 61)   // 亮度 (27 - 88)
                ];
                colors.push(`hsl(${hue[0]}, ${hue[1]}%, ${hue[2]}%)`);
            }

            return colors;
        }



    </script>

    <!-- album-3artist -->
    <script>

        document.getElementById('A0').style.backgroundImage = "url('{{ recent_3_artist[0]['img'] }}')";
        document.getElementById('A1').style.backgroundImage = "url('{{ recent_3_artist[1]['img'] }}')";
        document.getElementById('A2').style.backgroundImage = "url('{{ recent_3_artist[2]['img'] }}')";
        fetch('static/recent_3_artist.json')
            .then(response => response.json())
            .then(data => {
                // 在這裡使用 data 對 HTML 做相應的操作
                console.log(data);
                document.getElementById('B0').style.backgroundImage = `url('${data[0].img}')`;
                document.getElementById('B0').setAttribute('data-text', data[0].name);
                document.getElementById('B0').href = data[0].url
                document.getElementById('B1').style.backgroundImage = `url('${data[1].img}')`;
                document.getElementById('B1').setAttribute('data-text', data[1].name);
                document.getElementById('B1').href = data[1].url
                document.getElementById('B2').style.backgroundImage = `url('${data[2].img}')`;
                document.getElementById('B2').setAttribute('data-text', data[2].name);
                document.getElementById('B2').href = data[2].url
            })
    </script>

    <!-- RADER -->
    <!-- <script>

        var options = {
            series: [{
                name: 'Series 1',
                data: [5, 2, 5, 7, 10],
            }, {
                name: 'Series 2',
                data: {{ analyze_result| safe}},
            }
            ],
        chart: {
            height: 350,
                type: 'radar',
                    dropShadow: {
                enabled: true,
                    blur: 1,
                        left: 1,
                            top: 1
            }
        },
        title: {
            text: 'Radar Chart - Multi Series'
        },
        stroke: {
            width: 2
        },
        fill: {
            opacity: 0.1
        },
        markers: {
            size: 0
        },
        xaxis: {
            categories: ['instrumentalness', 'energy', 'valence', 'tempo', 'danceability']

        }
        };

        var chart = new ApexCharts(document.querySelector("#radar"), options);
        chart.render();
    </script> -->
    <!-- high -->
    <!-- <script>
        var options = {
            series: [{
                name: 'Males',
                data: [0.4, 0.65, 0.76, 0.88, 1.5]
            },
            {
                name: 'Females',
                data: [-0.8, -1.05, -1.06, -1.18, -1.4]
            }
            ],
            chart: {
                type: 'bar',
                height: 300,
                stacked: true
            },
            colors: ['#008FFB', '#FF4560'],
            plotOptions: {
                bar: {
                    horizontal: true,
                    barHeight: '80%',
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: 1,
                colors: ["#fff"]
            },

            grid: {
                xaxis: {
                    lines: {
                        show: false
                    }
                }
            },
            yaxis: {
                min: -5,
                max: 5,
                title: {
                    // text: 'Age',
                },
            },
            tooltip: {
                shared: false,
                x: {
                    formatter: function (val) {
                        return val
                    }
                },
                y: {
                    formatter: function (val) {
                        return Math.abs(val) + "%"
                    }
                }
            },
            title: {
                text: 'Mauritius population pyramid 2011'
            },
            xaxis: {
                categories: ['85+', '80-84', '75-79', '70-74', '65-69'],
                title: {
                    text: 'Percent'
                },
                labels: {
                    formatter: function (val) {
                        return Math.abs(Math.round(val)) + "%"
                    }
                }
            },
        };

        var chart = new ApexCharts(document.querySelector("#compare"), options);
        chart.render();
    </script> -->

    <script>

        let data = [];
        let features = ['instrumental', 'energetic', 'mood', 'tempo', 'rhythmic'];
        // //generate the data
        // for (var i = 0; i < 2; i++) {
        //     var point = {}
        //     //each feature will be a random number from 1-9
        //     features.forEach(f => point[f] = 1 + Math.random() * 8);
        //     data.push(point);
        // }
        // API_data=[2.1500166160000003, 5.929859999999999, 4.152900000000001, 5.432358000000001, 5.8458000000000006]
        // console.log(data);
        API_data = {{ analyze_result | safe }}

        API_data2 = [2.1500166160000003, 5.929859999999999, 4.152900000000001, 5.432358000000001, 5.8458000000000006];
        // 生成新的數據
        for (var i = 0; i < 1; i++) {
            var point = {};
            // 每個特徵將是對應 API_data 的值
            features.forEach((f, index) => point[f] = API_data[index]);
            data.push(point);
        }

        for (var i = 0; i < 1; i++) {
            var point = {};
            // 每個特徵將是對應 API_data 的值
            features.forEach((f, index) => point[f] = API_data2[index]);
            data.push(point);
        }

        console.log(data);

        let width = 300;
        let height = 250;
        let svg = d3.select("#radar").append("svg")
            .attr("width", width)
            .attr("height", height);

        let radialScale = d3.scaleLinear()
            .domain([0, 10])
            .range([0, 80]); // 調整雷達圖半徑

        let ticks = [2, 4, 6, 8, 10];
        svg.selectAll("circle")
            .data(ticks)
            .join(
                enter => enter.append("circle")
                    .attr("cx", width / 2)
                    .attr("cy", height / 2)
                    .attr("fill", "none")
                    .attr("stroke", "white")
                    .attr("stroke-opacity", 0.5)
                    .attr("r", d => radialScale(d))
            );
        svg.selectAll(".ticklabel")
            .data(ticks)
            .join(
                enter => enter.append("text")
                    .attr("class", "ticklabel")
                    .attr("x", width / 2 + 5)
                    .attr("y", d => height / 2 - radialScale(d))
                    .text(d => d.toString())
            );

        function angleToCoordinate(angle, value) {
            let x = Math.cos(angle) * radialScale(value);
            let y = Math.sin(angle) * radialScale(value);
            return {
                "x": width / 2 + x,
                "y": height / 2 - y
            };
        }
        let featureData = features.map((f, i) => {
            let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
            return {
                "name": f,
                "angle": angle,
                "line_coord": angleToCoordinate(angle, 10),
                "label_coord": angleToCoordinate(angle, 10.5)
            };
        });

        // draw axis line
        svg.selectAll("line")
            .data(featureData)
            .join(
                enter => enter.append("line")
                    .attr("x1", width / 2)
                    .attr("y1", height / 2)
                    .attr("x2", d => d.line_coord.x)
                    .attr("y2", d => d.line_coord.y)
                    .attr("stroke", "white")
                    .attr("stroke-opacity", 0.5)

            );

        // draw axis label
        svg.selectAll(".axislabel")
            .data(featureData)
            .join(
                enter => enter.append("text")
                    .attr("x", d => d.label_coord.x)
                    .attr("y", d => d.label_coord.y)
                    .text(d => d.name)
                    .attr("fill", "white")
                    .style("font-family", "'Arima', sans-serif") // 设置 Google Fonts 字体


            );
        let line = d3.line()
            .x(d => d.x)
            .y(d => d.y);
        let colors = ["#ad80da", "#e5c442"];

        function getPathCoordinates(data_point) {
            let coordinates = [];
            for (var i = 0; i < features.length; i++) {
                let ft_name = features[i];
                let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
                coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
            }
            return coordinates;
        }
        // draw the path element
        svg.selectAll("path")
            .data(data)
            .join(
                enter => enter.append("path")
                    .datum(d => getPathCoordinates(d))
                    .attr("d", line)
                    .attr("stroke-width", 3)
                    .attr("stroke", (_, i) => colors[i])
                    .attr("fill", (_, i) => colors[i])
                    .attr("stroke-opacity", 1)
                    .attr("opacity", 0.5)
            );

    </script>


    <!-- <div class="column-4">
        <canvas id="Genres_doughnut"></canvas>
    </div>
    <div class="column-4">
        <canvas id="Genres_doughnut-2"></canvas>
    </div> -->



    <!-- <div style="width: 40%; margin: auto;">
        <svg id="doughnut-chart"></svg>
    </div> -->
    <!-- <script>
        genere_doughnut();
        // D3_doughunt();
        function D3_doughunt() {
            // data = {{ top_50_artist }};
            // 計算比例
            var total = d3.sum(data, function (d) { return d.count; });

            var pie = d3.pie()
                .sort(null)
                .value(function (d) { return d.count; });

            var arc = d3.arc()
                .innerRadius(0)
                .outerRadius(100);

            var color = d3.scaleOrdinal()
                .range(['#FF6384', '#36A2EB', '#FFCE56', '#FF5733', '#33FF57', '#5733FF', '#A233FF', '#FF33A2', '#A2FF33', '#33FFCE', '#CE33FF']);

            // 創建 SVG 元素
            var svg = d3.select("#doughnut-chart")
                .append("svg")
                .attr("width", 200)
                .attr("height", 200)
                .append("g")
                .attr("transform", "translate(100,100)");

            // 生成 Doughnut Chart
            var path = svg.selectAll("path")
                .data(pie(data))
                .enter().append("path")
                .attr("d", arc)
                .attr("fill", function (d, i) { return color(i); });

            // 添加懸停提示
            path.on("mouseover", function (d) {
                var percentage = ((d.data.count / total) * 100).toFixed(2) + "%";
                console.log(percentage);
            });
        }

        function genere_doughnut() {
            var data = {{ top_50_artist | safe
        }};
        var options = {
            responsive: true,
            maintainAspectRatio: false,
            borderColor: '#000000',
            legend: {  // 資料標籤的位置
                display: false
            },
            tooltip: {
                display: false  // 隱藏資訊欄
            },
            plugins: {
                customCanvasBackgroundColor: {
                    color: '#000000',
                }
            }

        }
        var doughnut_genere = new Chart(document.getElementById('Genres_doughnut').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: data['name'],
                datasets: [{
                    data: data['count'],
                    backgroundColor: generateColors(data['count'].length)
                }]
            },
            options: options

        });
        var doughnut_genere = new Chart(document.getElementById('Genres_doughnut-2').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: data['name'],
                datasets: [{
                    data: data['count'],
                    backgroundColor: generateColors(data['count'].length)
                }]
            },
            options: options

        });
        }
        function generateColors(count) {
            var colors = [];
            for (var i = 0; i < count; i++) {
                var hue = [
                    214 - ((i * (24 / count)) % 24), // 色相 (214 - 190)
                    97 + ((i * (20 / count)) % 20), // 飽和度 (97 - 77)
                    27 + ((i * (61 / count)) % 61)  // 亮度 (27 - 88)
                ];
                colors.push(`hsl(${hue[0]}, ${hue[1]}%, ${hue[2]}%)`);
            }
            console.log(colors);
            return colors;
        }

    </script>

    <script>
        // 資料
        var data = {{ top_50_artist }};

        // 餅狀圖的寬度和高度
        var width = 300;
        var height = 300;

        // 設定SVG容器
        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        // 定義餅狀圖的弧形函數
        var arc = d3.arc()
            .innerRadius(60) // 內半徑，即甜甜圈的大小
            .outerRadius(Math.min(width, height) / 2);

        // 創建一個D3.js的餅狀圖
        var pie = d3.pie();

        // 設定漸層顏色
        var colors = generateColors(data['count'].length);

        // 自定義排序，確保標籤的順序與圓弧一致
        var sortedData = pie(data['count']).sort(function (a, b) {
            return a.index - b.index;
        });

        // 添加圓弧到SVG容器
        var arcs = svg.selectAll("path")
            .data(sortedData)
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", function (d, i) {
                // 使用漸層顏色
                return colors[i];
            });

        // 添加標籤
        var labels = svg.selectAll("text")
            .data(sortedData)
            .enter()
            .append("text")
            .text(function (d) {
                return d.data['name'];
            })
            .attr("transform", function (d) {
                return "translate(" + arc.centroid(d) + ")";
            })
            .style("text-anchor", "middle")
            .attr("opacity", 0); // 初始將標籤設為透明

        // 添加事件處理
        arcs.on("mouseover", function (d, i) {
            labels.attr("opacity", function (labelData, labelIndex) {
                return labelIndex === i.index ? 1 : 0;
            });
        })
            .on("mouseout", function (d, i) {
                labels.attr("opacity", 0);
            });

        function generateColors(count) {
            var colors = [];
            for (var i = 0; i < count; i++) {
                var hue = [
                    214 - ((i * (24 / count)) % 24), // 色相 (214 - 190)
                    97 + ((i * (20 / count)) % 20), // 飽和度 (97 - 77)
                    27 + ((i * (61 / count)) % 61)  // 亮度 (27 - 88)
                ];
                colors.push(`hsl(${hue[0]}, ${hue[1]}%, ${hue[2]}%)`);
            }
            console.log(colors);
            return colors;
        }
    </script> -->
</body>

</html>