<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"
        integrity="sha512-M7nHCiNUOwFt6Us3r8alutZLm9qMt4s9951uo8jqO4UwJ1hziseL6O3ndFyigx6+LREfZqnhHxYjKRJ8ZQ69DQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="https://unpkg.com/d3-3d@3.0.4/build/d3-3d.js"></script> -->
    <!-- chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- STATIC -->
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
    <!-- ECHART -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.common.min.js"
        integrity="sha512-0wDoQXJkUrgPk8OvsJ/hSJiBVXiII1ixzjKddv6RQUoCTZsB9GRF4S6oszAqeSgU6FlSusayKNC2VTUpZsb9pA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- APEXCHART -->
    <!-- 引入 ApexCharts 库 -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!-- 引入 ApexCharts 的样式 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.26.1/dist/apexcharts.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- font -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arima:wght@500&display=swap" rel="stylesheet">
    <title>LETS XSS SPOTIFY</title>
</head>

<body>
    <div class="row">
        <div class="col-3 shelf">
            <div class="mt-5">
                <div id="double_genere1"
                    style="transform: rotateX(6deg) rotateY(38deg) rotateZ(-19deg);margin-top: -13%;" class="left L3">
                </div>
                <div class="left L2" style="display: flex;">
                    <svg width="295" height="101" viewBox="0 0 295 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M189.083 1L294 15.85V27.1L102.3 100L1 78.85V65.8L189.083 1Z" fill="black" />
                        <path
                            d="M1 65.8L102.3 86.5M1 65.8L189.083 1L294 15.85M1 65.8V78.85L102.3 100M102.3 86.5L294 15.85M102.3 86.5V100M294 15.85V27.1L102.3 100"
                            stroke="#DBDBDB" />
                    </svg>

                </div>
                <div id="double_genere2"
                    style="transform: rotateX(6deg) rotateY(38deg) rotateZ(-19deg);margin-top: -13%;" class="left L1">
                </div>

                <div class="left">
                    <svg width="295" height="101" viewBox="0 0 295 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M189.083 1L294 15.85V27.1L102.3 100L1 78.85V65.8L189.083 1Z" fill="black" />
                        <path
                            d="M1 65.8L102.3 86.5M1 65.8L189.083 1L294 15.85M1 65.8V78.85L102.3 100M102.3 86.5L294 15.85M102.3 86.5V100M294 15.85V27.1L102.3 100"
                            stroke="#DBDBDB" />
                    </svg>

                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="three_cube">
                <div class="row ">
                    <div class="cube" id="A0"></div>
                    <div class="cube" id="A1"></div>
                    <div class="cube" id="A2"></div>
                </div>
                <div class="row">
                    <div class="cube"></div>
                    <div class="cube"></div>
                    <div class="cube"></div>
                </div>
            </div>
        </div>
        <div class="col-3">MUSIC DASH</div>
        <div class="col-2">4</div>
    </div>
    <h2>currently playing = {{ current_track }}</h2>
    <p>{{ recent_3_artist }}</p>
    <!-- 使用 home 路由的數據 -->

    <!-- 使用 about 路由的數據 -->
    <!-- <h2>top 50's total = {{ top_50_artist }}</h2> -->

    <!-- 其他 HTML 和 JavaScript 代碼 -->
    <!-- <script src="{{ url_for('static', filename='js/d3.js') }}"></script> -->

    <!-- D3-chart -->
    <script>
        // 資料
        // 在兩個容器中分別創建餅圖
        createPieChart("double_genere1");
        createPieChart("double_genere2");
        function createPieChart(containerId) {
            var data2 = {{ top_50_artist| safe
        }};
        let data = [30, 40, 50, 20];
        console.log(data2['count']);
        console.log(data);
        data = data2['count'];
        // 餅狀圖的寬度和高度
        var width = 200;
        var height = 200;

        var svg = d3.select("#" + containerId)
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        // 定義餅狀圖的弧形函數
        var arc = d3.arc()
            .innerRadius(width / 5) // 內半徑，即甜甜圈的大小
            .outerRadius(Math.min(width, height) / 2);

        // 創建一個D3.js的餅狀圖
        var pie = d3.pie();
        // 設定漸層顏色
        var colors = generateColors(data.length);

        // 自定義排序，確保標籤的順序與圓弧一致
        var sortedData = pie(data).sort(function (a, b) {
            return a.index - b.index;
        });
        /* console.log(sortedData); */
        // 添加圓弧到SVG容器
        var arcs = svg.selectAll("path")
            .data(sortedData)
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", function (d, i) {
                // 使用漸層顏色
                return colors[i];
            });

        // 添加標籤
        var labels = svg.selectAll("text")
            .data(sortedData)
            .enter()
            .append("text")
            .text(function (d) {
                return data2['name'][d.index];
            })
            .attr("transform", function (d) {
                return "translate(" + arc.centroid(d) + ")";
            })
            .style("text-anchor", "middle")
            .style("fill", "#F37D0E")
            .style("font-family", "'Arima', sans-serif") // 设置 Google Fonts 字体
            .attr("opacity", 0) // 初始將標籤設為透明


        // 添加事件處理
        arcs.on("mouseover", function (d, i) {
            labels.attr("opacity", function (labelData, labelIndex) {
                return labelIndex === i.index ? 1 : 0;
            });
        })
            .on("mouseout", function (d, i) {
                labels.attr("opacity", 0);
            });
        }
        // 產生漸層顏色
        function generateColors(count) {
            var colors = [];
            for (var i = 0; i < count; i++) {
                var hue = [
                    214 - ((i * (24 / count)) % 24), // 色相 (214 - 190)
                    97 + ((i * (20 / count)) % 20),  // 飽和度 (97 - 77)
                    27 + ((i * (61 / count)) % 61)   // 亮度 (27 - 88)
                ];
                colors.push(`hsl(${hue[0]}, ${hue[1]}%, ${hue[2]}%)`);
            }

            return colors;
        }



    </script>

    <!-- album-3artist -->
    <script>
        let second_artist = [];
        data1 = {{ recent_3_artist | tojson(indent = 2) }};
        // 藝人 name
        let artist_name = [];
        // 藝人圖片
        let artist_img = [];
        // 藝人 popularity
        let artist_pop = [];

        for (i = 0; i < 3; i++) {
            artist_name.push(data1['items'][i]['name']);
            artist_img.push('url(' + data1['items'][i]['images'][1]['url'] + ')');
            artist_pop.push(data1['items'][i]['popularity'])
        }
        console.log(artist_img);
        document.getElementById('A0').style.backgroundImage = artist_img[0];
        document.getElementById('A1').style.backgroundImage = artist_img[1];
        document.getElementById('A2').style.backgroundImage = artist_img[2];



    </script>


    <!-- <div class="column-4">
        <canvas id="Genres_doughnut"></canvas>
    </div>
    <div class="column-4">
        <canvas id="Genres_doughnut-2"></canvas>
    </div> -->



    <!-- <div style="width: 40%; margin: auto;">
        <svg id="doughnut-chart"></svg>
    </div> -->
    <!-- <script>
        genere_doughnut();
        // D3_doughunt();
        function D3_doughunt() {
            // data = {{ top_50_artist }};
            // 計算比例
            var total = d3.sum(data, function (d) { return d.count; });

            var pie = d3.pie()
                .sort(null)
                .value(function (d) { return d.count; });

            var arc = d3.arc()
                .innerRadius(0)
                .outerRadius(100);

            var color = d3.scaleOrdinal()
                .range(['#FF6384', '#36A2EB', '#FFCE56', '#FF5733', '#33FF57', '#5733FF', '#A233FF', '#FF33A2', '#A2FF33', '#33FFCE', '#CE33FF']);

            // 創建 SVG 元素
            var svg = d3.select("#doughnut-chart")
                .append("svg")
                .attr("width", 200)
                .attr("height", 200)
                .append("g")
                .attr("transform", "translate(100,100)");

            // 生成 Doughnut Chart
            var path = svg.selectAll("path")
                .data(pie(data))
                .enter().append("path")
                .attr("d", arc)
                .attr("fill", function (d, i) { return color(i); });

            // 添加懸停提示
            path.on("mouseover", function (d) {
                var percentage = ((d.data.count / total) * 100).toFixed(2) + "%";
                console.log(percentage);
            });
        }

        function genere_doughnut() {
            var data = {{ top_50_artist | safe
        }};
        var options = {
            responsive: true,
            maintainAspectRatio: false,
            borderColor: '#000000',
            legend: {  // 資料標籤的位置
                display: false
            },
            tooltip: {
                display: false  // 隱藏資訊欄
            },
            plugins: {
                customCanvasBackgroundColor: {
                    color: '#000000',
                }
            }

        }
        var doughnut_genere = new Chart(document.getElementById('Genres_doughnut').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: data['name'],
                datasets: [{
                    data: data['count'],
                    backgroundColor: generateColors(data['count'].length)
                }]
            },
            options: options

        });
        var doughnut_genere = new Chart(document.getElementById('Genres_doughnut-2').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: data['name'],
                datasets: [{
                    data: data['count'],
                    backgroundColor: generateColors(data['count'].length)
                }]
            },
            options: options

        });
        }
        function generateColors(count) {
            var colors = [];
            for (var i = 0; i < count; i++) {
                var hue = [
                    214 - ((i * (24 / count)) % 24), // 色相 (214 - 190)
                    97 + ((i * (20 / count)) % 20), // 飽和度 (97 - 77)
                    27 + ((i * (61 / count)) % 61)  // 亮度 (27 - 88)
                ];
                colors.push(`hsl(${hue[0]}, ${hue[1]}%, ${hue[2]}%)`);
            }
            console.log(colors);
            return colors;
        }

    </script>

    <script>
        // 資料
        var data = {{ top_50_artist }};

        // 餅狀圖的寬度和高度
        var width = 300;
        var height = 300;

        // 設定SVG容器
        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        // 定義餅狀圖的弧形函數
        var arc = d3.arc()
            .innerRadius(60) // 內半徑，即甜甜圈的大小
            .outerRadius(Math.min(width, height) / 2);

        // 創建一個D3.js的餅狀圖
        var pie = d3.pie();

        // 設定漸層顏色
        var colors = generateColors(data['count'].length);

        // 自定義排序，確保標籤的順序與圓弧一致
        var sortedData = pie(data['count']).sort(function (a, b) {
            return a.index - b.index;
        });

        // 添加圓弧到SVG容器
        var arcs = svg.selectAll("path")
            .data(sortedData)
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", function (d, i) {
                // 使用漸層顏色
                return colors[i];
            });

        // 添加標籤
        var labels = svg.selectAll("text")
            .data(sortedData)
            .enter()
            .append("text")
            .text(function (d) {
                return d.data['name'];
            })
            .attr("transform", function (d) {
                return "translate(" + arc.centroid(d) + ")";
            })
            .style("text-anchor", "middle")
            .attr("opacity", 0); // 初始將標籤設為透明

        // 添加事件處理
        arcs.on("mouseover", function (d, i) {
            labels.attr("opacity", function (labelData, labelIndex) {
                return labelIndex === i.index ? 1 : 0;
            });
        })
            .on("mouseout", function (d, i) {
                labels.attr("opacity", 0);
            });

        function generateColors(count) {
            var colors = [];
            for (var i = 0; i < count; i++) {
                var hue = [
                    214 - ((i * (24 / count)) % 24), // 色相 (214 - 190)
                    97 + ((i * (20 / count)) % 20), // 飽和度 (97 - 77)
                    27 + ((i * (61 / count)) % 61)  // 亮度 (27 - 88)
                ];
                colors.push(`hsl(${hue[0]}, ${hue[1]}%, ${hue[2]}%)`);
            }
            console.log(colors);
            return colors;
        }
    </script> -->
</body>

</html>